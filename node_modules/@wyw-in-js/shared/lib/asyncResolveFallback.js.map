{"version":3,"file":"asyncResolveFallback.js","names":["_path","_interopRequireDefault","require","obj","__esModule","default","safeResolve","name","where","resolve","paths","e","suffixes","reduce","acc","ext","push","syncResolve","what","importer","stack","map","p","path","dirname","resolved","Error","suffix","resolvedWithSuffix","exports","asyncResolveFallback","Promise"],"sources":["../src/asyncResolveFallback.ts"],"sourcesContent":["import path from 'path';\n\nconst safeResolve = (name: string, where: string[]): string | Error => {\n  try {\n    return require.resolve(name, {\n      paths: where,\n    });\n  } catch (e: unknown) {\n    return e as Error;\n  }\n};\n\nconst suffixes = ['.js', '.ts', '.jsx', '.tsx'].reduce((acc: string[], ext) => {\n  acc.push(`/index${ext}`);\n  acc.push(ext);\n  return acc;\n}, []);\n\nexport const syncResolve = (\n  what: string,\n  importer: string,\n  stack: string[]\n): string => {\n  const where = [importer, ...stack].map((p) => path.dirname(p));\n  const resolved = safeResolve(what, where);\n  if (!(resolved instanceof Error)) {\n    return resolved;\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const suffix of suffixes) {\n    const resolvedWithSuffix = safeResolve(what + suffix, where);\n    if (resolvedWithSuffix instanceof Error) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    return resolvedWithSuffix;\n  }\n\n  throw resolved;\n};\n\nexport const asyncResolveFallback = (\n  what: string,\n  importer: string,\n  stack: string[]\n): Promise<string> => {\n  const resolved = syncResolve(what, importer, stack);\n  return Promise.resolve(resolved);\n};\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AAAwB,SAAAD,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAExB,MAAMG,WAAW,GAAGA,CAACC,IAAY,EAAEC,KAAe,KAAqB;EACrE,IAAI;IACF,OAAON,OAAO,CAACO,OAAO,CAACF,IAAI,EAAE;MAC3BG,KAAK,EAAEF;IACT,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOG,CAAU,EAAE;IACnB,OAAOA,CAAC;EACV;AACF,CAAC;AAED,MAAMC,QAAQ,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,CAACC,MAAM,CAAC,CAACC,GAAa,EAAEC,GAAG,KAAK;EAC7ED,GAAG,CAACE,IAAI,CAAE,SAAQD,GAAI,EAAC,CAAC;EACxBD,GAAG,CAACE,IAAI,CAACD,GAAG,CAAC;EACb,OAAOD,GAAG;AACZ,CAAC,EAAE,EAAE,CAAC;AAEC,MAAMG,WAAW,GAAGA,CACzBC,IAAY,EACZC,QAAgB,EAChBC,KAAe,KACJ;EACX,MAAMZ,KAAK,GAAG,CAACW,QAAQ,EAAE,GAAGC,KAAK,CAAC,CAACC,GAAG,CAAEC,CAAC,IAAKC,aAAI,CAACC,OAAO,CAACF,CAAC,CAAC,CAAC;EAC9D,MAAMG,QAAQ,GAAGnB,WAAW,CAACY,IAAI,EAAEV,KAAK,CAAC;EACzC,IAAI,EAAEiB,QAAQ,YAAYC,KAAK,CAAC,EAAE;IAChC,OAAOD,QAAQ;EACjB;;EAEA;EACA,KAAK,MAAME,MAAM,IAAIf,QAAQ,EAAE;IAC7B,MAAMgB,kBAAkB,GAAGtB,WAAW,CAACY,IAAI,GAAGS,MAAM,EAAEnB,KAAK,CAAC;IAC5D,IAAIoB,kBAAkB,YAAYF,KAAK,EAAE;MACvC;MACA;IACF;IAEA,OAAOE,kBAAkB;EAC3B;EAEA,MAAMH,QAAQ;AAChB,CAAC;AAACI,OAAA,CAAAZ,WAAA,GAAAA,WAAA;AAEK,MAAMa,oBAAoB,GAAGA,CAClCZ,IAAY,EACZC,QAAgB,EAChBC,KAAe,KACK;EACpB,MAAMK,QAAQ,GAAGR,WAAW,CAACC,IAAI,EAAEC,QAAQ,EAAEC,KAAK,CAAC;EACnD,OAAOW,OAAO,CAACtB,OAAO,CAACgB,QAAQ,CAAC;AAClC,CAAC;AAACI,OAAA,CAAAC,oBAAA,GAAAA,oBAAA"}
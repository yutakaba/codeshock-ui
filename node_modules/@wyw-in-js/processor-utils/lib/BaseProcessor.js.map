{"version":3,"file":"BaseProcessor.js","names":["_generator","_interopRequireDefault","require","_shared","_getClassNameAndSlug","_toCSS","_validateParams","obj","__esModule","default","BaseProcessor","SKIP","Symbol","artifacts","dependencies","interpolations","constructor","params","tagSource","astService","location","replacer","displayName","isReferenced","idx","options","context","validateParams","className","slug","getClassNameAndSlug","callee","isValidValue","value","isCSSable","hasEvalMeta","toString","tagSourceCode","type","name","generator","code","exports"],"sources":["../src/BaseProcessor.ts"],"sourcesContent":["/* eslint-disable class-methods-use-this */\nimport type { NodePath, types as t } from '@babel/core';\nimport generator from '@babel/generator';\nimport type {\n  Expression,\n  Identifier,\n  SourceLocation,\n  MemberExpression,\n} from '@babel/types';\n\nimport type { Artifact, ExpressionValue } from '@wyw-in-js/shared';\nimport { hasEvalMeta } from '@wyw-in-js/shared';\n\nimport type { IInterpolation, Params, Value, ValueCache } from './types';\nimport getClassNameAndSlug from './utils/getClassNameAndSlug';\nimport { isCSSable } from './utils/toCSS';\nimport type { IFileContext, IOptions } from './utils/types';\nimport { validateParams } from './utils/validateParams';\n\nexport { Expression };\n\nexport type ProcessorParams = ConstructorParameters<typeof BaseProcessor>;\nexport type TailProcessorParams = ProcessorParams extends [Params, ...infer T]\n  ? T\n  : never;\n\nexport type TagSource = {\n  imported: string;\n  source: string;\n};\n\nexport abstract class BaseProcessor {\n  public static SKIP = Symbol('skip');\n\n  public readonly artifacts: Artifact[] = [];\n\n  public readonly className: string;\n\n  public readonly dependencies: ExpressionValue[] = [];\n\n  public interpolations: IInterpolation[] = [];\n\n  public readonly slug: string;\n\n  protected callee: Identifier | MemberExpression;\n\n  protected evaluated:\n    | Record<'dependencies' | 'expression', Value[]>\n    | undefined;\n\n  public constructor(\n    params: Params,\n    public tagSource: TagSource,\n    protected readonly astService: typeof t & {\n      addDefaultImport: (source: string, nameHint?: string) => Identifier;\n      addNamedImport: (\n        name: string,\n        source: string,\n        nameHint?: string\n      ) => Identifier;\n    },\n    public readonly location: SourceLocation | null,\n    protected readonly replacer: (\n      replacement: Expression | ((tagPath: NodePath) => Expression),\n      isPure: boolean\n    ) => void,\n    public readonly displayName: string,\n    public readonly isReferenced: boolean,\n    protected readonly idx: number,\n    protected readonly options: IOptions,\n    protected readonly context: IFileContext\n  ) {\n    validateParams(\n      params,\n      ['callee'],\n      'Unknown error: a callee param is not specified'\n    );\n\n    const { className, slug } = getClassNameAndSlug(\n      this.displayName,\n      this.idx,\n      this.options,\n      this.context\n    );\n\n    this.className = className;\n    this.slug = slug;\n\n    [[, this.callee]] = params;\n  }\n\n  /**\n   * A replacement for tag referenced in a template literal.\n   */\n  public abstract get asSelector(): string;\n\n  /**\n   * A replacement for the tag in evaluation time.\n   * For example, `css` tag will be replaced with its className,\n   * whereas `styled` tag will be replaced with an object with metadata.\n   */\n  public abstract get value(): Expression;\n\n  public isValidValue(value: unknown): value is Value {\n    return (\n      typeof value === 'function' || isCSSable(value) || hasEvalMeta(value)\n    );\n  }\n\n  public toString(): string {\n    return this.tagSourceCode();\n  }\n\n  protected tagSourceCode(): string {\n    if (this.callee.type === 'Identifier') {\n      return this.callee.name;\n    }\n\n    return generator(this.callee).code;\n  }\n\n  public abstract build(values: ValueCache): void;\n\n  /**\n   * Perform a replacement for the tag in evaluation time.\n   * For example, `css` tag will be replaced with its className,\n   * whereas `styled` tag will be replaced with an object with metadata.\n   */\n  public abstract doEvaltimeReplacement(): void;\n\n  /**\n   * Perform a replacement for the tag with its runtime version.\n   * For example, `css` tag will be replaced with its className,\n   * whereas `styled` tag will be replaced with a component.\n   * If some parts require evaluated data for render,\n   * they will be replaced with placeholders.\n   */\n  public abstract doRuntimeReplacement(): void;\n}\n"],"mappings":";;;;;;AAEA,IAAAA,UAAA,GAAAC,sBAAA,CAAAC,OAAA;AASA,IAAAC,OAAA,GAAAD,OAAA;AAGA,IAAAE,oBAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AAEA,IAAAI,eAAA,GAAAJ,OAAA;AAAwD,SAAAD,uBAAAM,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAjBxD;;AA+BO,MAAeG,aAAa,CAAC;EAClC,OAAcC,IAAI,GAAGC,MAAM,CAAC,MAAM,CAAC;EAEnBC,SAAS,GAAe,EAAE;EAI1BC,YAAY,GAAsB,EAAE;EAE7CC,cAAc,GAAqB,EAAE;EAUrCC,WAAWA,CAChBC,MAAc,EACPC,SAAoB,EACRC,UAOlB,EACeC,QAA+B,EAC5BC,QAGV,EACOC,WAAmB,EACnBC,YAAqB,EAClBC,GAAW,EACXC,OAAiB,EACjBC,OAAqB,EACxC;IAAA,KAnBOR,SAAoB,GAApBA,SAAoB;IAAA,KACRC,UAOlB,GAPkBA,UAOlB;IAAA,KACeC,QAA+B,GAA/BA,QAA+B;IAAA,KAC5BC,QAGV,GAHUA,QAGV;IAAA,KACOC,WAAmB,GAAnBA,WAAmB;IAAA,KACnBC,YAAqB,GAArBA,YAAqB;IAAA,KAClBC,GAAW,GAAXA,GAAW;IAAA,KACXC,OAAiB,GAAjBA,OAAiB;IAAA,KACjBC,OAAqB,GAArBA,OAAqB;IAExC,IAAAC,8BAAc,EACZV,MAAM,EACN,CAAC,QAAQ,CAAC,EACV,gDACF,CAAC;IAED,MAAM;MAAEW,SAAS;MAAEC;IAAK,CAAC,GAAG,IAAAC,4BAAmB,EAC7C,IAAI,CAACR,WAAW,EAChB,IAAI,CAACE,GAAG,EACR,IAAI,CAACC,OAAO,EACZ,IAAI,CAACC,OACP,CAAC;IAED,IAAI,CAACE,SAAS,GAAGA,SAAS;IAC1B,IAAI,CAACC,IAAI,GAAGA,IAAI;IAEhB,CAAC,GAAG,IAAI,CAACE,MAAM,CAAC,CAAC,GAAGd,MAAM;EAC5B;;EAEA;AACF;AACA;;EAGE;AACF;AACA;AACA;AACA;;EAGSe,YAAYA,CAACC,KAAc,EAAkB;IAClD,OACE,OAAOA,KAAK,KAAK,UAAU,IAAI,IAAAC,gBAAS,EAACD,KAAK,CAAC,IAAI,IAAAE,mBAAW,EAACF,KAAK,CAAC;EAEzE;EAEOG,QAAQA,CAAA,EAAW;IACxB,OAAO,IAAI,CAACC,aAAa,CAAC,CAAC;EAC7B;EAEUA,aAAaA,CAAA,EAAW;IAChC,IAAI,IAAI,CAACN,MAAM,CAACO,IAAI,KAAK,YAAY,EAAE;MACrC,OAAO,IAAI,CAACP,MAAM,CAACQ,IAAI;IACzB;IAEA,OAAO,IAAAC,kBAAS,EAAC,IAAI,CAACT,MAAM,CAAC,CAACU,IAAI;EACpC;;EAIA;AACF;AACA;AACA;AACA;;EAGE;AACF;AACA;AACA;AACA;AACA;AACA;AAEA;AAACC,OAAA,CAAAhC,aAAA,GAAAA,aAAA"}